<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NXD - Nexus Data Exchange</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üè≠ NXD</h1>
                <p>Nexus Data Exchange</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" data-page="live">
                    <span class="nav-icon">üì°</span>
                    <span class="nav-text">Live View</span>
                </li>
                <li class="nav-item" data-page="ativos">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text">Ativos / Baias</span>
                </li>
                <li class="nav-item" data-page="ia">
                    <span class="nav-icon">ü§ñ</span>
                    <span class="nav-text">Central de IA</span>
                </li>
                <li class="nav-item" data-page="financeiro">
                    <span class="nav-icon">üí∞</span>
                    <span class="nav-text">Financeiro</span>
                </li>
                <li class="nav-item" data-page="comparativo">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Comparativos</span>
                </li>
                <li class="nav-item" data-page="nxd-ativos">
                    <span class="nav-icon">üì¶</span>
                    <span class="nav-text">NXD Ativos</span>
                </li>
                <li class="nav-item" data-page="config">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Configura√ß√µes</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div class="factory-badge" id="factory-badge">
                    <span class="factory-icon">üè≠</span>
                    <span class="factory-name" id="sidebar-factory-name">-</span>
                </div>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Login Section -->
            <div id="login-section" class="page active">
                <div class="login-container">
                    <div class="login-header">
                        <h1>üè≠ NXD</h1>
                        <p>Nexus Data Exchange - Intelig√™ncia Industrial em Tempo Real</p>
                    </div>
                    
                    <!-- N√£o logado: Entrar com Google -->
                    <div id="login-google-card" class="login-card">
                        <h2>Entrar</h2>
                        <p>Use sua conta Google para acessar o NXD.</p>
                        <a href="/api/auth/google/login" class="btn-primary btn-google">Entrar com Google</a>
                    </div>
                    
                    <!-- Logado sem f√°brica: Criar f√°brica -->
                    <div id="login-create-factory-card" class="login-card" style="display:none">
                        <h2>Criar sua f√°brica</h2>
                        <p>Voc√™ ainda n√£o tem uma f√°brica cadastrada. Crie uma para come√ßar.</p>
                        <div class="form-group">
                            <label>Nome da f√°brica</label>
                            <input type="text" id="factory-name" placeholder="Ex: Pl√°sticos ABC" />
                            <button class="btn-primary" onclick="createFactoryAuth()">Criar f√°brica</button>
                        </div>
                        <div id="api-key-result" class="api-result"></div>
                    </div>
                    
                    <!-- Acesso legado por API Key (opcional) -->
                    <div class="login-card" style="margin-top:1rem">
                        <h3>Acessar com API Key</h3>
                        <input type="text" id="api-key-input" placeholder="Cole sua API Key" />
                        <button class="btn-secondary" onclick="loadDashboard()">Entrar</button>
                    </div>
                </div>
            </div>

            <!-- Live View Page = Dashboard de Al√≠vio + detalhe -->
            <div id="live-page" class="page">
                <div class="page-header">
                    <h2>üì° Vis√£o geral</h2>
                    <p>Pulso do neg√≥cio em tempo real</p>
                </div>
                
                <!-- Dashboard de Al√≠vio: cards de resumo -->
                <div id="alivio-cards" class="alivio-cards">
                    <div class="alivio-card operando">
                        <span class="alivio-number" id="card-online">0</span>
                        <span class="alivio-label">Operando</span>
                    </div>
                    <div class="alivio-card paradas">
                        <span class="alivio-number" id="card-offline">0</span>
                        <span class="alivio-label">Paradas</span>
                    </div>
                    <div class="alivio-card criticos">
                        <span class="alivio-number" id="card-critical">0</span>
                        <span class="alivio-label">Alertas cr√≠ticos</span>
                    </div>
                    <div class="alivio-card producao">
                        <span class="alivio-number" id="card-pecas">0</span>
                        <span class="alivio-label">Produ√ß√£o (hoje)</span>
                    </div>
                    <div class="alivio-card lucro">
                        <span class="alivio-number" id="card-lucro">R$ 0</span>
                        <span class="alivio-label">Lucro cessante</span>
                    </div>
                </div>
                <p id="alivio-message" class="alivio-message"></p>
                
                <h3 class="section-title">M√°quinas</h3>
                <div id="machines-grid" class="machines-grid">
                    <!-- Cards de m√°quinas -->
                </div>
                
                <div id="no-machines" class="empty-state">
                    <p>‚è≥ Aguardando dados do DX...</p>
                    <p>Configure o m√≥dulo DX com a API Key e os dados aparecer√£o aqui.</p>
                </div>
            </div>

            <!-- Ativos / Baias Page -->
            <div id="ativos-page" class="page">
                <div class="page-header">
                    <h2>üìã Gest√£o de Ativos e Setores</h2>
                    <p>Organize m√°quinas em setores (baias), renomeie e adicione anota√ß√µes</p>
                </div>
                <div class="config-cards">
                    <div class="config-card">
                        <h3>Novo setor</h3>
                        <input type="text" id="sector-name" placeholder="Ex: Linha de Montagem A" />
                        <button class="btn-primary" onclick="createSector()">Criar setor</button>
                    </div>
                </div>
                <h3 class="section-title">Setores</h3>
                <ul id="sectors-list" class="sectors-list"></ul>
                <h3 class="section-title">M√°quinas</h3>
                <div id="ativos-machines" class="ativos-table-wrap">
                    <p class="empty-state">Carregue o dashboard primeiro. As m√°quinas aparecer√£o aqui para voc√™ atribuir a setores e renomear.</p>
                </div>
            </div>

            <!-- Central de IA Page -->
            <div id="ia-page" class="page">
                <div class="page-header">
                    <h2>ü§ñ Central de IA</h2>
                    <p>Relat√≥rio mastigado com filtros: setor, per√≠odo, turno e nicho (Financeiro, Produ√ß√£o, Manuten√ß√£o)</p>
                </div>
                <div class="config-cards report-ia-filters">
                    <div class="config-card">
                        <h3>Filtros</h3>
                        <div class="form-row">
                            <label>Setor</label>
                            <select id="ia-sector"><option value="">Todos</option></select>
                        </div>
                        <div class="form-row">
                            <label>Per√≠odo</label>
                            <select id="ia-period">
                                <option value="hoje">Hoje</option>
                                <option value="ultima_semana">√öltima semana</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Turno</label>
                            <select id="ia-shift">
                                <option value="">Todos</option>
                                <option value="manha">Manh√£</option>
                                <option value="tarde">Tarde</option>
                                <option value="noite">Noite</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Detalhamento</label>
                            <select id="ia-detail">
                                <option value="baixo">Baixo</option>
                                <option value="medio" selected>M√©dio</option>
                                <option value="detalhado">Detalhado</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Nichos do relat√≥rio</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="ia-nicho-financeiro" checked /> Financeiro</label>
                                <label><input type="checkbox" id="ia-nicho-producao" checked /> Produ√ß√£o</label>
                                <label><input type="checkbox" id="ia-nicho-manutencao" checked /> Manuten√ß√£o</label>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="generateReportIA()">Gerar relat√≥rio</button>
                    </div>
                </div>
                <div id="ia-result" class="report-ia-result" style="display:none">
                    <h3 class="section-title">Relat√≥rio</h3>
                    <div id="ia-report-text" class="report-text"></div>
                    <h3 class="section-title">Rastreabilidade (Caminho da Verdade)</h3>
                    <p class="rastreabilidade-intro">Cada dado tem fonte, origem, processamento e data/hora.</p>
                    <div id="ia-rastreabilidade" class="rastreabilidade-list"></div>
                </div>
            </div>

            <!-- NXD Gest√£o de Ativos (v2) -->
            <div id="nxd-ativos-page" class="page">
                <div class="page-header">
                    <h2>üì¶ NXD Gest√£o de Ativos</h2>
                    <p>Tags descobertas e setores (baias). Selecione a f√°brica e organize os ativos.</p>
                </div>
                <div class="nxd-ativos-toolbar">
                    <label>F√°brica NXD</label>
                    <select id="nxd-factory-select"><option value="">-- Selecione --</option></select>
                    <button class="btn-secondary" id="nxd-create-factory-btn" style="display:none">Criar f√°brica NXD</button>
                </div>
                <div id="nxd-ativos-content" class="nxd-ativos-layout" style="display:none">
                    <div class="nxd-col-left">
                        <h3 class="section-title">Origem (Tags descobertas)</h3>
                        <input type="text" id="nxd-search-ungrouped" placeholder="Buscar..." />
                        <ul id="nxd-ungrouped-list" class="nxd-asset-list"></ul>
                    </div>
                    <div class="nxd-col-right">
                        <div class="nxd-setores-header">
                            <h3 class="section-title">Setores</h3>
                            <button class="btn-primary" id="nxd-create-group-btn">+ Criar Setor</button>
                        </div>
                        <div id="nxd-groups-cards" class="nxd-groups-cards"></div>
                    </div>
                </div>
                <div id="nxd-ativos-empty" class="empty-state">Selecione uma f√°brica NXD ou crie uma para come√ßar.</div>
            </div>

            <!-- Financeiro Page -->
            <div id="financeiro-page" class="page">
                <div class="page-header">
                    <h2>üí∞ Painel Financeiro</h2>
                    <p>Impacto financeiro em tempo real</p>
                </div>
                
                <div class="widgets-grid">
                    <!-- Widget Lucro Cessante -->
                    <div class="widget widget-large lucro-cessante">
                        <div class="widget-header">
                            <h3>üí∏ Lucro Cessante</h3>
                            <span class="widget-subtitle">Preju√≠zo por m√°quinas paradas</span>
                        </div>
                        <div class="widget-body">
                            <div class="big-number negative" id="lucro-cessante-total">
                                R$ 0,00
                            </div>
                            <div class="lucro-details" id="lucro-details">
                                <!-- Detalhes por m√°quina -->
                            </div>
                        </div>
                    </div>

                    <!-- Widget Produ√ß√£o Total -->
                    <div class="widget producao-total">
                        <div class="widget-header">
                            <h3>üì¶ Produ√ß√£o Total</h3>
                            <span class="widget-subtitle">Pe√ßas produzidas hoje</span>
                        </div>
                        <div class="widget-body">
                            <div class="big-number positive" id="total-pecas">0</div>
                            <span class="unit">pe√ßas</span>
                        </div>
                    </div>

                    <!-- Widget Energia -->
                    <div class="widget energia-total">
                        <div class="widget-header">
                            <h3>‚ö° Consumo Energia</h3>
                            <span class="widget-subtitle">Total do dia</span>
                        </div>
                        <div class="widget-body">
                            <div class="big-number neutral" id="total-energia">0</div>
                            <span class="unit">kWh</span>
                        </div>
                    </div>
                </div>

                <!-- Tabela de Status Financeiro -->
                <div class="table-container">
                    <h3>üìã Status Financeiro por M√°quina</h3>
                    <table class="data-table" id="financial-table">
                        <thead>
                            <tr>
                                <th>M√°quina</th>
                                <th>Status</th>
                                <th>Custo/Hora</th>
                                <th>Tempo Parado</th>
                                <th>Preju√≠zo</th>
                            </tr>
                        </thead>
                        <tbody id="financial-table-body">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Comparativo Page -->
            <div id="comparativo-page" class="page">
                <div class="page-header">
                    <h2>üìä An√°lise Comparativa</h2>
                    <p>Compare o desempenho das m√°quinas</p>
                </div>
                
                <div class="widgets-grid">
                    <!-- Widget Efici√™ncia -->
                    <div class="widget widget-large">
                        <div class="widget-header">
                            <h3>üèÜ Radar de Efici√™ncia</h3>
                            <span class="widget-subtitle">Pe√ßas produzidas por kWh consumido</span>
                        </div>
                        <div class="widget-body">
                            <div class="chart-container">
                                <canvas id="efficiency-chart"></canvas>
                            </div>
                            <div class="efficiency-winner" id="efficiency-winner">
                                <!-- M√°quina mais eficiente -->
                            </div>
                        </div>
                    </div>

                    <!-- Widget Sa√∫de -->
                    <div class="widget widget-large">
                        <div class="widget-header">
                            <h3>üîÆ Previs√£o de Parada</h3>
                            <span class="widget-subtitle">Indicador de sa√∫de das m√°quinas</span>
                        </div>
                        <div class="widget-body">
                            <div class="health-indicators" id="health-indicators">
                                <!-- Indicadores de sa√∫de -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gr√°fico de Produ√ß√£o -->
                <div class="chart-full-width">
                    <h3>üìà Produ√ß√£o Comparativa</h3>
                    <div class="chart-container-large">
                        <canvas id="production-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Config Page -->
            <div id="config-page" class="page">
                <div class="page-header">
                    <h2>‚öôÔ∏è Configura√ß√µes</h2>
                    <p>Configure sua f√°brica e integra√ß√£o</p>
                </div>
                
                <div class="config-cards">
                    <div class="config-card">
                        <h3>üîë API Key</h3>
                        <p>Use esta chave no nanoDX. Mostrada s√≥ na cria√ß√£o ou ao regenerar.</p>
                        <div class="api-key-display" id="config-api-key">-</div>
                        <button class="btn-secondary" onclick="copyApiKey()">üìã Copiar</button>
                        <button id="btn-regenerate-api" class="btn-secondary" onclick="regenerateApiKey()" style="margin-left:8px; display:none">Regenerar API Key</button>
                    </div>

                    <div class="config-card">
                        <h3>üì° Endpoint de Ingest√£o</h3>
                        <p>Configure o DX para enviar dados para:</p>
                        <div class="api-key-display" id="config-endpoint">-</div>
                        <button class="btn-secondary" onclick="copyEndpoint()">üìã Copiar</button>
                    </div>

                    <div class="config-card">
                        <h3>üè≠ Informa√ß√µes da F√°brica</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Nome:</span>
                                <span class="info-value" id="config-factory-name">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">M√°quinas conectadas:</span>
                                <span class="info-value" id="config-machine-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>
